<h2>Sign Our Guestbook</h2>

<div class="form-container">
  <form id="guestbook-form" action="/entries" method="post" class="guestbook-form">
    <div class="form-row">
      <label for="visitor_name">Name <span class="required">*</span></label>
      <div class="field-container">
        <input type="text" id="visitor_name" name="visitor_name" required placeholder="Your name">
      </div>
    </div>
    
    <div class="form-row">
      <label for="email">Email (optional)</label>
      <div class="field-container">
        <input type="email" id="email" name="email" placeholder="your.email@example.com" 
               pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" 
               title="Please enter a valid email address">
      </div>
    </div>
    
    <div class="form-row">
      <label for="message">Message <span class="required">*</span></label>
      <div class="field-container">
        <textarea id="message" name="message" required placeholder="Write your message here..." rows="4"></textarea>
      </div>
    </div>
    
    <div class="form-row">
      <button type="submit" class="submit-btn">Sign the Guestbook</button>
    </div>
  </form>
</div>

<script>
// Store and recall form data using localStorage
document.addEventListener('DOMContentLoaded', function() {
  const nameInput = document.getElementById('visitor_name');
  const emailInput = document.getElementById('email');
  
  // Load saved data on page load
  const savedName = localStorage.getItem('guestbook_name');
  const savedEmail = localStorage.getItem('guestbook_email');
  
  if (savedName) nameInput.value = savedName;
  if (savedEmail) emailInput.value = savedEmail;
  
  // Save name and email as user types
  nameInput.addEventListener('input', function() {
    localStorage.setItem('guestbook_name', this.value);
  });
  
  emailInput.addEventListener('input', function() {
    localStorage.setItem('guestbook_email', this.value);
  });
});
</script>

<hr class="divider">

<h2>Guest Messages</h2>

<% if @entries && @entries.empty? %>
  <div class="empty-state">
    <p>No entries yet. Be the first to leave a message!</p>
  </div>
<% else %>
  <div class="entries-container">
    <% @entries.each do |entry| %>
      <article class="guestbook-entry">
        <div class="entry-header">
          <h3 class="visitor-name">
            <%= h(entry['visitor_name']) %>
            <% if entry['email'] && !entry['email'].empty? %>
              <span class="email">(<%= h(entry['email']) %>)</span>
            <% end %>
          </h3>
          <time class="entry-time" datetime="<%= entry['created_at'] %>">
            <%= Time.parse(entry['created_at']).strftime('%B %d, %Y at %I:%M %p') %>
          </time>
        </div>
        <div class="entry-content">
          <%= h(entry['message']).gsub(/\n/, '<br>') %>
        </div>
      </article>
    <% end %>
  </div>
<% end %>